<!DOCTYPE html>
<html lang="en">
<head>
    <div th:replace="fragments.html :: header"></div>
    <script
            src="https://maps.googleapis.com/maps/api/js?sensor=false&callback=initMap&libraries=&v=weekly"
            async
    ></script>
</head>
<body>
<div id="navbar" th:replace="fragments.html :: navbar"></div>
<div class="container">

    <h3>Project map</h3>
    <div id="map-canvas"></div>

    <!--The div element for the map -->
    <div id="map"></div>


    <script th:inline="javascript">
        // write code here


        function initMap() {
            //     // The location of Uluru
            //     const cardiff = {lat: 51.481583, lng: -3.179090};
            //     // The map, centered at Uluru
            //     const map = new google.maps.Map(document.getElementById("map"), {
            //         zoom: 8,
            //         center: cardiff,
            //     });
            //     // The marker, positioned at Uluru
            //
            //     let locations = [[${locations}]]
            //     var marker, i;
            //     for (i = 0; i < locations.length; i++) {
            //
            //         marker = new google.maps.Marker({
            //             position: {lat: locations[i].latitude, lng: locations[i].longitude},
            //             map: map,
            //             title: locations[i].name,
            //             url: "http://localhost:8080/project/".concat(locations[i].projectId),
            //             id: locations[i].id,
            //             onclick: openPopup(locations[i].id);
            //
            //
            //         });
            //
            //
            //         const infowindow = new google.maps.InfoWindow({
            //             content: "Popup",
            //         });
            //         // google.maps.event.addListener(marker, 'click', function () {
            //         //     window.location.href = marker.url;
            //         // });
            //
            //         marker.addListener("click", (x) => {
            //             infowindow.open({
            //
            //                 anchor: marker,
            //                 map,
            //                 shouldFocus: false,
            //             });
            //         });
            //     }


            // The location of Uluru
            const cardiff = {lat: 51.481583, lng: -3.179090};
            // The map, centered at Uluru


            var mapOptions = {
                zoom: 8,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                center: cardiff

            };

            let locations = [[${locations}]]


            var map = new google.maps.Map(document.getElementById('map'), mapOptions);

            var infowindow = new google.maps.InfoWindow();

            for (var i = 0; i < locations.length; i++) {

                var contenetName = locations[i].name;

                var contentUrl = "http://localhost:8080/project/".concat(locations[i].projectId);

                var marker = new google.maps.Marker({
                    position: {lat: locations[i].latitude, lng: locations[i].longitude},
                    map: map,
                    title: locations[i].name,
                });

                google.maps.event.addListener(marker, 'click', (function (marker, i) {

                    return function () {

                        const contentString =
                            '<div id="content">' +
                            '<div id="siteNotice">' +
                            "</div>" +
                            '<h1 id="firstHeading" class="firstHeading">' + locations[i].name + '</h1>' +
                            '<div id="bodyContent">' +
                            "<p>" + locations[i].projectDescription + "</p>" +
                            '<p> <a href=' + "http://localhost:8080/project/".concat(locations[i].projectId) + '>' +
                            "Projects Page" +
                            "</p>" +
                            "</div>" +
                            "</div>";
                        infowindow.setContent(contentString);
                        infowindow.open(map, marker);
                    }

                })(marker, i));
            }
        }


    </script>


</div>
<div th:replace="fragments.html :: footer"></div>

</body>
</html>